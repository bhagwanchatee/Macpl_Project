sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/format/DateFormat","sap/ui/core/library","zchequeprint/model/formatter"],(e,t,i,l,a,u)=>{"use strict";jQuery.sap.require("zchequeprint.model.jspdf");let s=a.ValueState;return e.extend("zchequeprint.controller.View1",{formatter:u,onInit(){this.aDocumentNumList=[];this.uniqueDocumentNumList=[];let e=(new Date).getFullYear();let t=(new Date).getMonth();if(t<3){e=e-1}this.byId("idFiscalYear").setValue(e);this.f4HelpModel=this.getOwnerComponent().getModel();this._oMutiSelectDialog=null;let i=new sap.ui.model.json.JSONModel({items:[],selectedItemsText:""});this.getView().setModel(i,"BulkRTGSModel")},onSelectChequeType:function(e){let t=e.getSource(),i=t.getSelectedKey(),l=t.getValue();if(!i&&l){t.setValueState(s.Error);t.setValueStateText("Invalid Value");this.byId("idPanelCheque").setVisible(false);this.byId("idPanelRTGS").setVisible(false);this.byId("idPanelBulkRTGS").setVisible(false)}else{t.setValueState(s.None);if(l===""){this.byId("idPanelCheque").setVisible(false);this.byId("idPanelRTGS").setVisible(false);this.byId("idPanelBulkRTGS").setVisible(false)}else if(l==="Cheque"){this.byId("idPanelCheque").setVisible(true);this.byId("idPanelRTGS").setVisible(false);this.byId("idPanelBulkRTGS").setVisible(false)}else if(l==="RTGS"){this.byId("idPanelCheque").setVisible(false);this.byId("idPanelRTGS").setVisible(true);this.byId("idPanelBulkRTGS").setVisible(false)}else if(l==="Bulk RTGS"){this.byId("idPanelCheque").setVisible(false);this.byId("idPanelRTGS").setVisible(false);this.byId("idPanelBulkRTGS").setVisible(true)}}},onChangeFiscalYear:function(e){let t=e.getSource();let i=t.getValue();let l=(new Date).getFullYear();if(isNaN(i)||i.length<4||parseInt(i)>l||parseInt(i)<=l-5){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Enter a valid year");t.setValue()}else{t.setValueState(sap.ui.core.ValueState.None);t.setValueStateText();this.clearUIFieldsOnChangeFiscalYear()}},clearUIFieldsOnChangeFiscalYear:function(){let e=this.getView();e.byId("idCheque_DocumentNo").setValue();e.byId("idCheque_SupplieName").setValue();e.byId("idCheque_ChequeDate").setValue();e.byId("idCheque_Amount").setValue();e.byId("idRTGS_DocumentNo").setValue();e.byId("idRTGS_SupplieName").setValue();e.byId("idRTGS_ChequeDate").setValue();e.byId("idRTGS_Amount").setValue();e.byId("idBulkRTGS_DocumentNo").setValue();e.byId("idBulkRTGS_SupplieName").setValue();e.byId("idBulkRTGS_ChequeDate").setValue();e.byId("idBulkRTGS_Amount").setValue()},loadAllData:function(e,t,i){const l=this.getView().getModel();const a="/MyEntitySet";const u=2e3;var s=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("FiscalYear",sap.ui.model.FilterOperator.EQ,t.toString()),new sap.ui.model.Filter("CompanyCode",sap.ui.model.FilterOperator.EQ,"1100")],and:true});return new Promise((t,i)=>{e.f4HelpModel.read("/CheckData/$count",{filters:[s],success:(l,a)=>{const n=Number(a.data);let o=[];let r=0;const d=()=>{e.f4HelpModel.read("/CheckData",{filters:[s],urlParameters:{$skip:r,$top:u},success:e=>{o.push(...e.results);r+=u;if(r<n){d()}else{t(o)}},error:i})};d()},error:i})})},getDocumentNumDetails:function(e,t,i){this.loadAllData(e,t,i).then(t=>{console.log("Final count:",t.length);e.aDocumentNumList=t.sort((e,t)=>{const i=new Date(e.DocumentDate);const l=new Date(t.DocumentDate);return l-i});const l="DocumentNumber";e.uniqueDocumentNumList=[...new Map(e.aDocumentNumList.map(e=>[e[l],e])).values()];i("Success")})},getDocumentNumDetails1:function(e,i,l){e.aDocumentNumList=[];e.uniqueDocumentNumList=[];let a={$top:2e4};var u=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("FiscalYear",sap.ui.model.FilterOperator.EQ,i.toString()),new sap.ui.model.Filter("CompanyCode",sap.ui.model.FilterOperator.EQ,"1100")],and:true});e.f4HelpModel.read("/CheckData",{filters:[u],urlParameters:a,success:function(t){e.aDocumentNumList=t.results.sort((e,t)=>{const i=new Date(e.DocumentDate);const l=new Date(t.DocumentDate);return l-i});const i="DocumentNumber";e.uniqueDocumentNumList=[...new Map(e.aDocumentNumList.map(e=>[e[i],e])).values()];l("Success")},error:function(e){l("Error");t.error("Failed to load Document Number list");console.log(e)}})},documentNumValueHelp:function(e){try{let t=this;let l=t.getView();let a=e.getSource();let s=l.byId("idFiscalYear").getValue();if(s===""){i.show("Select Fiscal Year");return}s=s.toString();l.setBusy(true);t.getDocumentNumDetails(t,s,function(e){l.setBusy(false);if(e==="Error"){return}let i=new sap.m.StandardListItem({active:true,title:"{DocumentNumber}",info:{path:"DocumentDate",formatter:function(e){return u.formatDate(e)}}});let n=new sap.m.SelectDialog({title:"Select Document Number",noDataText:"No Data",width:"50%",growing:true,growingThreshold:12,growingScrollToLoad:true,confirm:function(e){let i=e.getParameter("selectedContexts");if(i.length){let e=i.map(function(e){return e.getObject()});a.setValue(e[0].DocumentNumber);let u=l.byId("idCBoxCheckPrintType").getSelectedKey();if(u==="Cheque"){l.byId("idCheque_SupplieName").setValue();l.byId("idCheque_ChequeDate").setValue();l.byId("idCheque_Amount").setValue();t.getSupplierName(s,e[0])}else{l.byId("idRTGS_SupplieName").setValue();t.setSelectedDocNumData(e[0])}}},liveChange:function(e){let t=e.getParameter("value");var i=new sap.ui.model.Filter("DocumentNumber",sap.ui.model.FilterOperator.Contains,t);let l=e.getSource().getBinding("items");l.filter(i)}});let o=new sap.ui.model.json.JSONModel;o.setData({modelData:t.uniqueDocumentNumList});n.setModel(o);n.bindAggregation("items","/modelData",i);n.open()})}catch(e){oView.setBusy(false);console.log(e)}},getSupplierName:function(e,i){let l=this;let a=this.getView();let u=i.DocumentNumber;a.setBusy(true);var s=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("AccountingDocument",sap.ui.model.FilterOperator.EQ,u),new sap.ui.model.Filter("CompanyCode",sap.ui.model.FilterOperator.EQ,"1100"),new sap.ui.model.Filter("FiscalYear",sap.ui.model.FilterOperator.EQ,e.toString())],and:true});l.f4HelpModel.read("/SupplierData",{filters:[s],success:function(e){a.setBusy(false);if(e.results&&e.results.length>0){i.SupplierName=e.results[0].SupplierName;l.setSelectedDocNumData(i)}else{t.error("No Supplier present for the selected Document Number")}},error:function(e){a.setBusy(false);t.error("Failed to load Suplier Name")}})},setSelectedDocNumData:function(e){let t=this.getView();let i=l.getInstance({pattern:"MMM dd, yyyy"});let a=t.byId("idCBoxCheckPrintType").getSelectedKey();if(a==="Cheque"){t.byId("idCheque_SupplieName").setValue(e.SupplierName);t.byId("idCheque_ChequeDate").setValue(i.format(new Date(e.DocumentDate)));let l=parseFloat(e.Amount);l=l.toFixed(2);t.byId("idCheque_Amount").setValue(l)}else if(a==="RTGS"){t.byId("idRTGS_ChequeDate").setValue(i.format(new Date(e.DocumentDate)));let l=parseFloat(e.Amount);l=l.toFixed(2);t.byId("idRTGS_Amount").setValue(l)}else{let i=parseFloat(e.TotalAmount);i=i.toFixed(2);t.byId("idBulkRTGS_Amount").setValue(i)}},onValueHelpBulkRTGS:function(e){let t=this;let l=t.getView();let a=e.getSource();let s=l.byId("idFiscalYear").getValue();if(s===""){i.show("Select Fiscal Year");return}s=s.toString();l.setBusy(true);t.getDocumentNumDetails(t,s,function(e){l.setBusy(false);if(e==="Error"){return}if(!t._oMutiSelectDialog){t._oMutiSelectDialog=new sap.m.SelectDialog({title:"Select Document Numbers",multiSelect:true,cancel:t.onCancelDialog.bind(t),items:{path:"/items",template:new sap.m.StandardListItem({title:"{DocumentNumber}",info:{path:"DocumentDate",formatter:function(e){return u.formatDate(e)}},selected:"{isSelected}",type:"Active"})},confirm:function(e){let i=e.getParameter("selectedContexts");if(i.length){let e=i.map(function(e){return e.getObject()});let u=0;let s=[];e.forEach(e=>{u=u+parseFloat(e.Amount);s.push(e.DocumentNumber)});let n=s.join(", ");a.setValue(n);l.byId("idBulkRTGS_SupplieName").setValue();l.byId("idBulkRTGS_ChequeDate").setValue();e[0].TotalAmount=u;t.setSelectedDocNumData(e[0])}},liveChange:function(e){let t=e.getParameter("value");var i=new sap.ui.model.Filter("DocumentNumber",sap.ui.model.FilterOperator.Contains,t);let l=e.getSource().getBinding("items");l.filter(i)}});l.addDependent(t._oMutiSelectDialog)}let i=a.getValue();if(i!==""){i=i.split(", ");i.forEach(e=>{const i=t.uniqueDocumentNumList.findIndex(t=>e===t.DocumentNumber);t.uniqueDocumentNumList[i]={...t.uniqueDocumentNumList[i],isSelected:true}})}let s=new sap.ui.model.json.JSONModel;s.setData({items:t.uniqueDocumentNumList});t._oMutiSelectDialog.setModel(s);t._oMutiSelectDialog.open()})},onSearchDialog:function(e){const t=e.getParameter("value").toLowerCase();const i=[];if(t){i.push(new sap.ui.model.Filter([new sap.ui.model.Filter("DocumentNumber",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DocumentDate",sap.ui.model.FilterOperator.Contains,t)],false))}e.getSource().getBinding("items").filter(i)},onConfirmDialog:function(e){const t=e.getParameter("selectedContexts");const i=t.map(e=>e.getObject().name);const l=i.join(", ");this.getView().getModel("BulkRTGSModel").setProperty("/selectedItemsText",l)},onCancelDialog:function(){this._oMutiSelectDialog.getBinding("items").filter([])},printBankCheque:function(){let e=this.getView();let t=e.byId("idCBoxBank").getSelectedKey();let l=e.byId("idCBoxCheckPrintType").getSelectedKey();let a=e.byId("idFiscalYear").getValue();if(!t||!l||a===""){i.show("Enter All Mandatory Fields");return}let u,s,n,o;if(l==="Cheque"){u=e.byId("idCheque_DocumentNo").getValue();s=e.byId("idCheque_SupplieName").getValue();n=e.byId("idCheque_ChequeDate").getValue();o=e.byId("idCheque_Amount").getValue()}else if(l==="RTGS"){u=e.byId("idRTGS_DocumentNo").getValue();s=e.byId("idRTGS_SupplieName").getValue();n=e.byId("idRTGS_ChequeDate").getValue();o=e.byId("idRTGS_Amount").getValue()}else{u=e.byId("idBulkRTGS_DocumentNo").getValue();s=e.byId("idBulkRTGS_SupplieName").getValue();n=e.byId("idBulkRTGS_ChequeDate").getValue();o=e.byId("idBulkRTGS_Amount").getValue()}if(u===""||s===""||n===""||o===""){i.show("Fill the Cheque Details");return}else{this.onViewQR(t,s,n,o)}},onViewQR:function(e,t,i,l){const a=new Date(i);const u=String(a.getDate()).padStart(2,"0");const s=String(a.getMonth()+1).padStart(2,"0");const n=a.getFullYear();const o=`${u}${s}${n}`;const r=o.split("");const d=`${u}-${s}-${n}`;let c=this;let m=this.getView().byId("idVBox_QRCode");m.setVisible(true);const p=new sap.ui.core.HTML({content:'<canvas id="qrCanvas" width="200" height="200" style="display:none;"></canvas>'});m.addItem(p);setTimeout(function(){c._generatePDF(c,e,t,r,l,d);m.setVisible(false)},200)},_generatePDF:function(e,t,i,l,a,u){var s=window.jspdf.jsPDF;var n=new s("l","mm",[200,100]);n.setFont("Helvetica","bold");n.setFontSize(10);n.setTextColor("#000");let o=e.getView().byId("idCBoxCheckPrintType").getValue();let r="";if(o==="Cheque"){r="Cheque"}else if(o==="RTGS"||o==="Bulk RTGS"){r="RTGS"}if(t==="SBI"){n.text(159,9.5,l[0]);n.text(164,9.5,l[1]);n.text(169,9.5,l[2]);n.text(174.5,9.5,l[3]);n.text(179,9.5,l[4]);n.text(184.5,9.5,l[5]);n.text(189,9.5,l[6]);n.text(194.5,9.6,l[7]);n.text(21,23,i);let e=this.convertNumberToWords(a);if(e.length>76&&e.includes(" and ")){let t=e.split(" and ");n.text(38,31,t[0]+" and");n.text(38,37,t[1])}else{n.text(38,31,e)}n.text(160,37,a);n.text(94,45,"A/C PAYEE")}else if(t==="ICICI"){n.text(161,9,l[0]);n.text(166,9,l[1]);n.text(171.5,9,l[2]);n.text(176.5,9,l[3]);n.text(181.5,9,l[4]);n.text(186.5,9,l[5]);n.text(191.5,9,l[6]);n.text(196.5,9,l[7]);n.text(23,23,i);let e=this.convertNumberToWords(a);if(e.length>76&&e.includes(" and ")){let t=e.split(" and ");n.text(28,31,t[0]+" and");n.text(28,37,t[1])}else{n.text(28,31,e)}n.text(166,37,a);n.text(94,49,"A/C PAYEE")}else if(t==="MGB"){n.text(159,12.7,l[0]);n.text(164.5,12.7,l[1]);n.text(169.5,12.7,l[2]);n.text(174.5,12.7,l[3]);n.text(179.5,12.7,l[4]);n.text(184.5,12.7,l[5]);n.text(189.5,12.7,l[6]);n.text(194.5,12.7,l[7]);n.text(23,23.5,i);let e=this.convertNumberToWords(a);if(e.length>76&&e.includes(" and ")){let t=e.split(" and ");n.text(41,31.5,t[0]+" and");n.text(41,39.5,t[1])}else{n.text(41,31.5,e)}n.text(163,39.5,a);n.text(94,49,"A/C PAYEE")}n.save(`${t}_${r}_${i}_${u}.pdf`);this.clearUIFieldsAfterPrintCheque()},convertNumberToWords:function(e){const t=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"];const i=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];const l=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];const a=["","Thousand","Lakh","Crore"];function u(e){if(e<10)return t[e];else if(e<20)return i[e-10];else return l[Math.floor(e/10)]+(e%10?" "+t[e%10]:"")}function s(e){if(e===0)return"Zero";let i="";let l=[];l.push(e%1e3);e=Math.floor(e/1e3);while(e>0){l.push(e%100);e=Math.floor(e/100)}for(let e=l.length-1;e>=0;e--){let s=l[e];if(s===0)continue;if(e===0){if(s>99){i+=t[Math.floor(s/100)]+" Hundred ";s%=100}if(s>0){i+=u(s)+" "}}else{i+=u(s)+" "+a[e]+" "}}return i.trim()}let[n,o]=e.toString().split(".");let r=s(parseInt(n));if(o&&parseInt(o)>0){o=o.substring(0,2);r+=" Rupees and "+s(parseInt(o))+" Paise"}r+=" Only";return r},clearUIFieldsAfterPrintCheque:function(){let e=this.getView();e.byId("idCBoxBank").setSelectedKey();e.byId("idCBoxBank").setValue();e.byId("idCBoxCheckPrintType").setSelectedKey();e.byId("idCBoxCheckPrintType").setValue();e.byId("idCheque_DocumentNo").setValue();e.byId("idCheque_SupplieName").setValue();e.byId("idCheque_ChequeDate").setValue();e.byId("idCheque_Amount").setValue();e.byId("idRTGS_DocumentNo").setValue();e.byId("idRTGS_SupplieName").setValue();e.byId("idRTGS_ChequeDate").setValue();e.byId("idRTGS_Amount").setValue();e.byId("idBulkRTGS_DocumentNo").setValue();e.byId("idBulkRTGS_SupplieName").setValue();e.byId("idBulkRTGS_ChequeDate").setValue();e.byId("idBulkRTGS_Amount").setValue();this.byId("idPanelCheque").setVisible(false);this.byId("idPanelRTGS").setVisible(false);this.byId("idPanelBulkRTGS").setVisible(false)}})});
//# sourceMappingURL=View1.controller.js.map